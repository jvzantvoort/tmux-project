#!/bin/bash

if [[ -n "$TMUX" ]]
then
  SESSIONNAME="$(tmux display-message -p '#S'  2>/dev/null)"
  export SESSIONNAME

  #shellcheck disable=SC1090
  if [ -f "$HOME/.tmux.d/${SESSIONNAME}.env" ]
  then
    source  "$HOME/.tmux.d/${SESSIONNAME}.env"
  fi

  #shellcheck disable=SC2164
  function pcd()
  {
    # empty
    if [[ -z "$1" ]]
    then
      cd "${PROJDIR}"
      return
    fi
  
    __name="$1"
  
    # check for a config file and an entry
    if [[ -f "${PROJDIR}/.pcd.rc" ]]
    then
      dst="$(awk -v pat="${__name}" -F";" '$1 == pat { print $2 }' "${PROJDIR}/.pcd.rc" | sed "s,PROJDIR,${PROJDIR},")"
      if [[ -n "${dst}" ]]
      then
        cd "${dst}"
        return
      fi
    fi
  
    # subdir in project
    cd "$PROJDIR/${__name}";
  
  }

fi
